/*1327373492,169776321*/

if (window.CavalryLogger) { CavalryLogger.start_js(["9lDpd"]); }

__d("AvailableListConstants",[],function(c,e,f,d,b){var a={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_INTERFACES_CHANGED:'interfaces-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,legacyStatusMap:{'0':2,'1':1,'-1':0,'2':3},reverseLegacyStatusMap:{0:-1,1:1,2:0,3:2}};window.AvailableListConstants=d.exports=a;},3);
__d("ChatConfig",["ChatConfigInitialData","copyProperties"],function(f,h,i,g,e){var b=h('ChatConfigInitialData');var d=h('copyProperties');var c={};var a=g.exports={get:function(k,j){return k in c?c[k]:j;},set:function(j){if(arguments.length>1){var k={};k[j]=arguments[1];j=k;}d(c,j);},getDebugInfo:function(){return c;}};a.set(b);},3);
__d("dcode",[],function(d,f,g,e,c){var a,h={},b={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var j=[];for(var i in b){h[b[i]]=i;j.push(b[i]);}j.reverse();a=new RegExp(j.join("|"),'g');})();d.Dcode=e.exports={encode:function(i){return encodeURIComponent(i).replace(/([_A-Z])|%../g,function(k,j){return j?'%'+j.charCodeAt(0).toString(16):k;}).toLowerCase().replace(a,function(j){return h[j];});},decode:function(i){return decodeURIComponent(i.replace(/[_A-Z]/g,function(j){return b[j];}));}};},3);
__d("PresenceUtil",["Cookie","Env","math-extensions","tx"],function(f,h,i,g,e){var a=h('Cookie');var b=h('Env');var c=h('math-extensions');f.tx=h('tx');var d=c.rand32()+1;f.PresenceUtil=g.exports={checkMaintenanceError:function(j){if(j.getError()==1356007)return true;return false;},getErrorDescription:function(j){var l=j.getError();var k=j.getErrorDescription();if(!k)k="An error occurred.";if(l==1357001)k="Your session has timed out. Please log in.";return k;},getSessionID:function(){return d;},hasUserCookie:function(){return b.user===a.get('c_user');}};},3);
__d("presence-cookie-manager",["Cookie","dcode","JSLogger","json","PresenceInitialData","PresenceUtil","URI"],function(q,s,t,r,p){q.CookieManager=function(){};var a=s('Cookie');var b=s('dcode');var c=s('JSLogger');s('json');var d=s('PresenceInitialData');var e=s('PresenceUtil');var f=s('URI');var o=d.cookieVersion;var h=d.dictEncode;var g='presence';var n={};var k=null;var l=null;var j=c.create('presence_cookie');function i(){try{var data=a.get(g);if(k===data){return l;}else{k=data;l=null;}if(data&&data.charAt(0)=='E')data=b.decode(data.substring(1));if(data){l=JSON.parse(data);return l;}}catch(u){j.warn('getcookie_error');}return null;}function m(){return parseInt(new Date().getTime()/1000,10);}q.presenceCookieManager=r.exports={register:function(v,u){n[v]=u;},store:function(){var u=i();if(u&&u.v&&o<u.v)return;var v={v:o,time:m()};for(var y in n)v[y]=n[y]();var x=JSON.stringify(v);if(h)x='E'+b.encode(x);if(e.hasUserCookie()){var w=f.getRequestURI(false).isSecure()&&!!a.get('csm');a.set(g,x,null,null,w);}},clear:function(){a.clear(g);},getSubCookie:function(v){var u=i();if(!u)return null;return u[v];}};},3);
__d("PresenceState",["JSLogger","math-extensions","presence-cookie-manager"],function(r,u,v,s,q){var b=u('JSLogger');var c=u('math-extensions');var t=u('presence-cookie-manager');var a=2000;var m=[];var l=[];var p=null;var d=null;var k=null;var n=0;var g=null;var o=0;var h=b.create('presence_state');function e(){clearTimeout(p);p=null;n=Date.now();t.store();i(k);}function f(){var y={ut:n};for(var w=0,x=m.length;w<x;w++)y=m[w](y);k=y;return k;}function i(x){o++;try{n=c.verifyNumber(x.ut);if(!d)d=setInterval(j,a);k=x;if(g===null)g=x;for(var i=0;i<l.length;i++)l[i](x);}catch(w){o--;throw w;}o--;}function j(){var w=t.getSubCookie('state');if(!w)return;if(w.ut>n){i(w);return;}}t.register('state',f);(function(){var x=t.getSubCookie('state');if(!x){h.debug('null_state');i(f());return;}try{i(x);}catch(w){h.error('load_exception',{e:w.toString()});i(f());}})();r.PresenceState=s.exports={doSync:function(w){if(o)return;if(w){e();}else if(!p)p=e.defer();},registerStateStorer:function(w){m.push(w);},registerStateLoader:function(w){l.push(w);},get:function(){return k;},getInitial:function(){return g;}};},3);
__d("presence-arbiter-message",[],function(b,d,e,c,a){b.PresenceMessage=c.exports={WINDOW_RESIZED:'presence/window-resized',TAB_CLOSED:'presence/tab-closed',TAB_OPENED:'presence/tab-opened',PRESENCE_UPDATER_READY:'presence/updater-ready',getAppMessageType:function(f,g){return 'presence/app_message:'+f+':'+g;},getArbiterMessageType:function(f){return 'presence/message:'+f;}};},3);
__d("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","copyProperties","Env","JSLogger","MercuryRequireEnsure","presence-arbiter-message","PresenceUtil"],function(zf,zn,zo,zh,ze){var a=zn('Arbiter');var b=zn('AsyncRequest');var c=zn('ChannelConstants');var zc=zn('copyProperties');var d=zn('Env');var e=zn('JSLogger');var f=zn('MercuryRequireEnsure');var g=zn('presence-arbiter-message');var i=zn('PresenceUtil');if(zf.PresencePrivacy){zh.exports=zf.PresencePrivacy;}else{var m='/ajax/chat/privacy/settings.php';var n='/ajax/chat/privacy/online_policy.php';var o='/ajax/chat/privacy/visibility.php';var j='friend_visibility';var l='visibility';var k='online_policy';var zg={};var zp;var zj={};var zk;var zd;var zi;var zm=[];var zl=false;function p(){return e.create('blackbird');}var h=zc(new a(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function x(zr){var zq;for(zq in zr){var zs=zr[zq];if(zq==d.user){p().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(zs){case h.WHITELISTED:case h.BLACKLISTED:case h.UNLISTED:break;default:p().error('set_invalid_friend_visibility',{id:zq,value:zs});throw new Error("Invalid state: "+zs);}}for(zq in zr)zg[zq]=zr[zq];h.inform('privacy-changed');}function y(zq,zs){var zr={};zr[zq]=zs;x(zr);}function za(zq){switch(zq){case h.ONLINE:case h.OFFLINE:break;default:p().error('set_invalid_visibility',{value:zq});throw new Error("Invalid visibility: "+zq);}zp=zq;h.inform('privacy-changed');h.inform('privacy-user-presence-changed');a.inform('chat/visibility-changed',{sender:this});}function z(zq){switch(zq){case h.ONLINE_TO_WHITELIST:case h.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+zq);}zd=zq;h.inform('privacy-user-presence-changed');h.inform('privacy-changed');}function zb(zr,zq){zl=true;zr.send();}function w(zr,zq){zm.push({request:zr,data:zq});if(!zl){next=zm.shift();zb(next.request,next.data);}}function u(zq,zr){var zs=zq.type;if(zs===j){var zu=zr.payload.user_availabilities;h.inform('privacy-availability-changed',{user_availabilities:zu});for(var zt in zq.settings)zj[zt]=zq.settings[zt];}else{if(zs===l){zk=zq.visibility;}else if(zs===k)zi=zq.online_policy;h.inform('privacy-user-presence-response');}p().log('set_update_response',{data:zq,response:zr});}function r(zq,zr){if(zp!==zk)za(zk);if(zd!==zi)z(zi);zc(zg,zj);h.inform('privacy-changed');zm=[];p().log('set_error_response',{data:zq,response:zr});}function s(zq){zl=false;if(zm.length>0){next=zm.shift();zb(next.request,next.data);}}function v(zs,zr){if(i!=null){var zq=zs.getData();zq.window_id=i.getSessionID();zs.setData(zq);}zs.setHandler(u.bind(this,zr)).setErrorHandler(r.bind(this,zr)).setTransportErrorHandler(r.bind(this,zr)).setFinallyHandler(s.bind(this)).setAllowCrossPageTransition(true);return zs;}function q(zs,zq,zr){return v(new b(zs).setData(zq),zr);}function t(zu,zq){var zt=zq.obj;if(zt.viewer_id!=d.user){p().error('invalid_viewer_for_channel_message',{type:zu,data:zq});throw new Error("Viewer got from the channel is not the real viewer");}if(zt.window_id===i.getSessionID())return;var zr=zt.data;if(zt.event=='access_control_entry'){zr.target_ids.forEach(function(zv){y(zv,zr.setting);zj[zv]=zr.setting;});}else{if(zt.event=='visibility_update'){var zs=!!zr.visibility?h.ONLINE:h.OFFLINE;za(zs);zk=zs;}else if(zt.event=='online_policy_update'){z(zr.online_policy);zi=zr.online_policy;}h.inform('privacy-user-presence-response');}p().log('channel_message_received',{data:zq.obj});}zc(h,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(zs,zq,zr){zp=zk=zs;zd=zi=zq;zg=zc({},zr);zj=zc({},zr);zl=false;this.inform('initialized',this,a.BEHAVIOR_PERSISTENT);this.inform('privacy-changed');this.inform('privacy-user-presence-changed');p().log('initialized',{visibility:zs,policy:zq});a.inform('chat-visibility/initialized',this,a.BEHAVIOR_PERSISTENT);a.subscribe(g.getArbiterMessageType('privacy_changed'),t.bind(this));a.subscribe(c.ON_CONFIG,function(zu,zt){var zw=zt.getConfig('visibility',null);if(zw!==null&&typeof(zw)!=='undefined'){var zv=zw?h.ONLINE:h.OFFLINE;za(zv);p().log('config_visibility',{vis:zv});}}.bind(this));a.subscribe('channel/visibility-config',function(zt,zu){var zv=zu?h.ONLINE:h.OFFLINE;if(zv!=zp){za(zv);p().log('config_visibility_old_channel',{vis:zv});}}.bind(this));},setVisibility:function(zt){zk=zp;za(zt);var zq={visibility:zt};var zr={type:l,visibility:zt};var zs=q(o,zq,zr);w(zs,zr);p().log('set_visibility',{data:zq});return zt;},getVisibility:function(){return zp;},setOnlinePolicy:function(zt){zi=zd;z(zt);var zq={online_policy:zt};var zr={type:k,online_policy:zt};var zs=q(n,zq,zr);w(zs,zr);p().log('set_online_policy',{data:zq});return zt;},getOnlinePolicy:function(){return zd;},getFriendVisibility:function(zq){return zg[zq]||h.UNLISTED;},allows:function(zq){if(this.getVisibility()===h.OFFLINE)return false;var zr=this.getOnlinePolicy();return zr===h.ONLINE_TO_WHITELIST?zg[zq]==h.WHITELISTED:zg[zq]!=h.BLACKLISTED;},setFriendsVisibility:function(zu,zy){if(zu.length>0){var zx={};for(var zs=0;zs<zu.length;zs++){var zt=zu[zs];zj[zt]=zg[zt];zx[zt]=zy;}x(zx);var zw=zy;if(zw==h.UNLISTED)zw=zj[zu[0]];var zq={users:zu,setting:zy,setting_type:zw};var zr={type:j,settings:zx};var zv=q(m,zq,zr);w(zv,zr);p().log('set_friend_visibility',{data:zq});}return zy;},setFriendVisibilityMap:function(zs,zt){for(var zr in zs)zj[zr]=zg[zr];x(zs);var zq={type:j,settings:zs};w(v(zt,zq),zq);p().log('set_friend_visibility_from_map',{data:zs});},allow:function(zq){if(this.allows(zq)){p().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===h.OFFLINE){p().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var zr=this.getOnlinePolicy()===h.ONLINE_TO_WHITELIST?h.WHITELISTED:h.UNLISTED;return this.setFriendsVisibility([zq],zr);},disallow:function(zq){if(!this.allows(zq)){p().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===h.OFFLINE){p().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var zr=this.getOnlinePolicy()===h.ONLINE_TO_BLACKLIST?h.BLACKLISTED:h.UNLISTED;return this.setFriendsVisibility([zq],zr);},getBlacklist:function(){var zr=[];for(var zq in zg)if(zg[zq]===h.BLACKLISTED)zr.push(zq);return zr;},getWhitelist:function(){var zr=[];for(var zq in zg)if(zg[zq]===h.WHITELISTED)zr.push(zq);return zr;},getMapForTest:function(){return zg;},setMapForTest:function(zq){zg=zq;}});f.ensure(['PresencePrivacyInitialData'],function(zq){h.init.bind(h,zq.visibility,zq.onlinePolicy,zq.privacyData).defer();});zf.PresencePrivacy=zh.exports=h;}},3);
__d("ShortProfiles",["Arbiter","ArrayUtils","JSLogger","ObjectUtils","AsyncRequest","Env","SystemEvents","Util","copyProperties","MercuryRequireEnsure"],function(zb,zd,ze,zc,za){var a=zd('Arbiter');var b=zd('ArrayUtils');var e=zd('JSLogger');var g=zd('ObjectUtils');var c=zd('AsyncRequest');var d=zd('Env');var i=zd('SystemEvents');var l=zd('Util');var z=zd('copyProperties');var f=zd('MercuryRequireEnsure');var x={};var m=new a();var n=[];var r=false;var t=false;var u=e.create('short_profiles');function o(){if(!n.length||r)return;r=true;p.defer();}function y(zf){var zg=[];b.createFrom(zf).forEach(function(zh){var zn={};for(var zk=0,zm=zh.ids.length;zk<zm;zk++){var zl=zh.ids[zk];if(x[zl]){zn[zl]=x[zl];}else{zn=null;break;}}if(zn){var zo={};for(var zi in zn)zo[zi]=z({},zn[zi]);try{zh.fun(zo);}catch(zj){var err=i.normalizeError(zj);err.profile_ids=zh.ids;i.informError(err);}}else zg.push(zh);});return zg;}function s(){r=false;o();}var j='/ajax/chat/user_info.php';var k='/ajax/chat/user_info_all.php';function p(zg){m.inform('fetch');var zf=y(n);n=[];if(!zf.length){s();return;}var zi={};zf.forEach(function(zj){zj.ids.forEach(function(zk){if(!x[zk])zi[zk]=true;});});var zh=g.getKeys(zi);new c(j).setData({ids:zh}).setHandler(function(zj){w(zj,zf);}).setErrorHandler(v).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();}function w(zh,zf){for(var zg in zh.payload){var zj=zh.payload[zg];if(!zj.type)zj.type='friend';x[zg]=zj;}if(zf)y(zf);n=y(n);s();m.inform('updated');var zi=zh.getRequest().uri.getPath();if(zi==j){u.log('fetch_response');}else if(zi==k)u.log('fetch_response_all');}function v(){u.error('fetch_error');s();}function q(){if(!t){u.log('fetch_all');t=true;new c(k).setData({viewer:d.user}).setHandler(w).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();}}var h=z(m,{get:function(zg,zf){this.getMulti([zg],function(zh){zf(zh[zg],zg);});},getMulti:function(zh,zg){var zf={ids:zh,fun:zg};var zi=y([zf]);if(zi.length){n.push(zf);o();}},getNow:function(zf){var zg=x[zf];if(zg)return z({},zg);return null;},getCachedProfileIDs:function(){return keys(x);},hasAll:function(){return t;},fetchAll:function(){q();},set:function(zf,zg){var zh=x[zf];if(zh&&(zh.name!=zg.name||zh.firstName!=zg.firstName||zh.thumbSrc!=zg.thumbSrc))u.warn('changed',{oldInfo:zh,newInfo:zg});x[zf]=z({},zg);},setMulti:function(zf){for(var zg in zf)this.set(zg,zf[zg]);}});f.ensure(['InitialChatUserInfos'],function(zf){h.setMulti(zf);});zb.ShortProfiles=zc.exports=h;},3);
function ChatOptions(b,a){this._jslog=JSLogger.create('chat_options');this._jslog.log('server',{vis:b});this.visibility=!!b;this._lastVisibilityChangeTime=0;this.settings=a;}ChatOptions.prototype={load:function(){requireLazy(['ChatConfig','PresenceUtil','PresenceState','ChannelConstants','ChannelManager'],function(c,e,d,a,b){this._chatConfig=c;this._presenceState=d;d.registerStateStorer(this._storeState.bind(this));d.registerStateLoader(this._loadState.bind(this));if(!c.get('blackbird')){Arbiter.subscribe(a.ON_CONFIG,function(g,f){var h=b.getConfig('visibility');this._jslog.log('vis_chan_config',{new_vis:h});this.setVisibility(h);}.bind(this));Arbiter.subscribe('channel/visibility-config',function(f,g){this._jslog.log('vis_chan_config',{new_vis:g});this.setVisibility(g);}.bind(this));}Arbiter.subscribe(PresenceMessage.getArbiterMessageType('visibility'),function(f,g){var h=g.obj;if(h.window_id===e.getSessionID())return;this._jslog.log('vis_chan_message',{new_vis:h.visibility,window_id:h.window_id});this.setVisibility(h.visibility);}.bind(this));Arbiter.subscribe(PresenceMessage.getArbiterMessageType('setting'),function(f,g){var h=g.obj;if(h.window_id===e.getSessionID())return;this.setSetting(h.setting,!!h.value);}.bind(this));Arbiter.inform('chat-options/initialized',this,Arbiter.BEHAVIOR_PERSISTENT);if(!c.get('blackbird')){this._jslog.log('define_vis_init',this.visibility);Arbiter.inform('chat-visibility/initialized',this,Arbiter.BEHAVIOR_PERSISTENT);}}.bind(this));},_storeState:function(a){a.vis=this.visibility?1:0;a.vct=this._lastVisibilityChangeTime;a.bls=this.getSetting('sticky_buddylist');a.blc=this.getSetting('compact_buddylist');a.snd=this.getSetting('sound');return a;},_loadState:function(b){if(!this._chatConfig.get('blackbird')){var a=verifyNumber(b.vct);var c=Math.max(Env.rep_lag,this._chatConfig.get('presence_cookie_setting_cache_window'));if(new Date()-a<c&&this._lastVisibilityChangeTime<a){if(b.vis!=this.visibility){this._jslog.log('vis_load',{new_vis:b.vis});this.setVisibility(!!b.vis);}this._lastVisibilityChangeTime=a;}}this.setSetting('sticky_buddylist',b.bls);this.setSetting('compact_buddylist',b.blc);this.setSetting('sound',b.snd);},setVisibility:function(a){if(a===this.visibility)return;this.visibility=a;this._lastVisibilityChangeTime=Date.now();Arbiter.inform('chat/visibility-changed',{sender:this});this._presenceState.doSync();},_onVisibilityResponse:function(a){this._jslog.log('vis_send_success',{new_vis:a});if(a)this.setVisibility(a);},_onVisibilityError:function(a){this._jslog.log('vis_send_error',{old_vis:a});this.setVisibility(a);},toggleVisibility:function(){this.sendVisibility(!this.visibility);},sendVisibility:function(a){requireLazy(['PresenceUtil'],function(b){this._jslog.log('vis_send',{old_vis:this.visibility,new_vis:a});if(this.visibility==a)return;var c={visibility:a,notify_ids:Chat.getActiveFriendChats(),window_id:b.getSessionID()};if(!a)this.setVisibility(a);new AsyncRequest('/ajax/chat/visibility.php').setHandler(this._onVisibilityResponse.shield(this,a)).setErrorHandler(this._onVisibilityError.shield(this,!a)).setData(c).setAllowCrossPageTransition(true).send();Arbiter.inform(a?'chat/connect':'chat/disconnect');}.bind(this));},getSetting:function(a){return this.settings[a];},setSetting:function(a,b){if(this.getSetting(a)==b)return;this.settings[a]=b;Arbiter.inform('chat/option-changed',{name:a,value:b});}};
__d("ChatVisibility",["Arbiter","ChatConfig","JSLogger","PresencePrivacy"],function(g,i,j,h,f){var a=i('Arbiter');var b=i('ChatConfig');var d=i('JSLogger');var e=i('PresencePrivacy');var c={isOnline:function(){if(b.get('blackbird'))return e.getVisibility()===e.ONLINE;return window.chatOptions&&window.chatOptions.visibility;},goOnline:function(k){if(b.get('blackbird')){e.subscribe('initialized',function(){if(e.getVisibility()===e.OFFLINE){d.create('blackbird').log('chat_go_online');e.setVisibility(e.ONLINE);}k&&k();});return;}a.subscribe('chat-options/initialized',function(event,l){if(l.visibility){k&&k();}else{if(k)var m=a.subscribe('chat/visibility-changed',function(){a.unsubscribe(m);k();});l.sendVisibility(true);}});},canGoOffline:function(){var k=a.inform('live_listen_chat/go_offline');if(k===false){d.create('music_live_listen').log('can_go_offline',false);return false;}return true;},goOffline:function(k){if(!this.canGoOffline())return;if(b.get('blackbird')){e.subscribe('initialized',function(){if(e.getVisibility()===e.ONLINE){d.create('blackbird').log('chat_go_offline');e.setVisibility(e.OFFLINE);}k&&k();});return;}a.subscribe('chat-options/initialized',function(event,l){if(l.visibility){if(k)var m=a.subscribe('chat/visibility-changed',function(){a.unsubscribe(m);k();});l.sendVisibility(false);}else k&&k();});},toggleVisibility:function(){if(c.isOnline()){c.goOffline();}else c.goOnline();}};g.ChatVisibility=h.exports=c;},3);
__d("Chat",["Arbiter","AsyncSignal","JSLogger","ObjectUtils","PresencePrivacy"],function(k,m,n,l,j){var a=m('Arbiter');var b=m('AsyncSignal');var d=m('JSLogger');var e=m('ObjectUtils');var f=m('PresencePrivacy');function h(p,q){if(q&&q=='ordered_list'||q=='more_online_friends'||q=='online_friends'||q=='typeahead'){var o={target:p,source:q};new b('/ajax/chat/ct.php',o).send();}}var g={chatDisplay:'chat-display/loaded',buddyListDisplay:'buddylist-display/initialized',buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function i(p,o){a.subscribe(g[p],function(event,q){o(q);});}var c={openTab:function(o,p,r,q){if(window.External&&window.External.Chat&&window.External.Chat.openWindow)window.External.Chat.openWindow(o);h(o,q);m.ensure(['ChatConfig'],function(s){if(s.get('mercury_integration')){m.ensure(['MercuryThreads'],function(t){if(!r||r=='friend'){var u=t.getCanonicalThreadToUser(o);a.inform('chat/open-tab',{thread_id:u.thread_id});}});}else i('chatDisplay',function(t){t.focusTab(o,true,p,p,r);});});},openMultichatTab:function(r,p,o,s,t,q){i('chatDisplay',function(u){u.createMultichatTab(r,p,o,s,t,true,q);});},loadTabFragile:function(p,q,o,r){n(['ChatConfig'],function(s){if(s.get('mercury_integration')){n(['ChatController'],function(t){t.raiseFragileGroupTab(p);});}else i('chatDisplay',function(t){t.loadTabFragile(p,q,o,r);});});},openBuddyList:function(){i('buddyListNub',function(o){o.show();i('sidebar',function(p){p.enable();});});},closeBuddyList:function(){i('buddyListNub',function(o){o.hide();});},toggleSidebar:function(){i('sidebar',function(o){o.toggle();});},goOnline:function(o){n(['ChatVisibility'],function(p){p.goOnline(o);});},isOnline:function(){var o=null;n(['ChatVisibility'],function(p){o=p;});return o&&o.isOnline();},squelchTab:function(o,p){i('chatDisplay',function(q){q.setSquelchedTab(o,true);q.closeTab(o);});},unsquelchTab:function(o){i('chatDisplay',function(p){p.setSquelchedTab(o,false);});},getActiveChats:function(){if(!window.chatDisplay)return [];return e.getKeys(window.chatDisplay.tabs);},hasFocusedChat:function(){return window.chatDisplay&&window.chatDisplay.hasFocusedTab();},getActiveFriendChats:function(){var o=this.getActiveChats();return o.filter(function(p){return window.chatDisplay&&window.chatDisplay.tabs[p]&&window.chatDisplay.tabs[p].getPostType()=='friend';});},getLogger:function(o){return d.create(o);}};k.Chat=l.exports=c;},3);
__d("ServerTime",["PresenceInitialData"],function(e,g,h,f,d){var a=g('PresenceInitialData');var b;function c(i){b=Date.now()-i;}c(a.serverTime);e.ServerTime=f.exports={get:function(){return Date.now()-b;},getSkew:function(){return b;},update:function(i){c(i);}};},3);
__d("AvailableList",["Arbiter","AvailableListConstants","ChannelConnection","ChannelConstants","Chat","ChatConfig","ChatVisibility","copyProperties","Env","isEmpty","JSLogger","ObjectUtils","Poller","PresencePrivacy","PresenceUtil","ServerTime","ShortProfiles","UserActivity","AvailableListInitialData"],function(zh,zzc,zzd,zt,zf){var a=zzc('Arbiter');var c=zzc('AvailableListConstants');var e=zzc('ChannelConnection');var f=zzc('ChannelConstants');var g=zzc('Chat');var h=zzc('ChatConfig');var i=zzc('ChatVisibility');var ze=zzc('copyProperties');var j=zzc('Env');var zm=zzc('isEmpty');var l=zzc('JSLogger');var q=zzc('ObjectUtils');var r=zzc('Poller');var s=zzc('PresencePrivacy');var t=zzc('PresenceUtil');var v=zzc('ServerTime');var w=zzc('ShortProfiles');var x=zzc('UserActivity');var k=zzc('AvailableListInitialData');var m=5;var p=60000;var u='/ajax/chat/buddy_list.php';var o=5000;var n=1800000;var d=.005;var zze=0;var zu=0;var zzb=false;var zz=k.pollInterval;var zq=k.lazyPollInterval;var zr=k.lazyThreshold;var zd=null;var zp=new Date();var zo=zp;var zza={};var zn=false;var zs={};var zl={};var zy={};var zx={};var y=l.create('available_list');var b=ze(new a(),c);b.subscribe([c.ON_AVAILABILITY_CHANGED,c.ON_UPDATE_ERROR,c.ON_UPDATED],function(zzl,zzk){a.inform(zzl,zzk);});function zg(zzk){var zzl=zzk||x.isActive(zr);return i.isOnline()?(zzl?zz:zq):null;}function z(zzm,zzk){var zzl=null;switch(zzm){case c.OFFLINE:zzl='offline';break;case c.IDLE:zzl='idle';break;case c.ACTIVE:zzl='active';break;case c.MOBILE:zzl='mobile';break;}y.rate(zzl,zzk);}function zzf(){zd=null;b.inform(c.ON_AVAILABILITY_CHANGED);}function zb(zzk,zzo,zzl,zzn){if(zzk==j.user)return;switch(zzo){case c.OFFLINE:case c.IDLE:case c.ACTIVE:case c.MOBILE:break;default:return;}var zzm=b.get(zzk)!=zzo;if(zzl){zy[zzk]=v.get();zx[zzk]=zzn;}zza[zzk]=zzo;if(zzm){zze++;if(!zd)zd=zzf.defer();z(zzo,zzl);}}function zzh(zzk){zo=new Date();zs=Object.from(zzk);}function zzj(){if(b.haveFullList)b.inform(c.ON_UPDATED,b);}function zv(zzk){if(t.checkMaintenanceError(zzk))return;zu++;zzb=false;if(zu>=m)b.inform(c.ON_UPDATE_ERROR);}function zw(zzn){var zzm=zzn.getPayload();var zzk=zzm.buddy_list;if(!zzk){zv(zzn);return;}v.update(zzm.time);b.updateTime=v.get();zu=0;zzb=false;b.haveFullList=true;if(zzk.mobile_friends!=null)zzh(zzk.mobile_friends);var zzp=zzk.userInfos;if(zzp)w.setMulti(zzp);var zzl=zzk.nowAvailableList;var zzq=[];for(var zzo in zza)if(b.get(zzo)!==b.OFFLINE)zzq.push(zzo);zzq.forEach(function(zzr){z(b.OFFLINE,false);zza[zzr]=b.OFFLINE;});zn=zzk.userIsIdle;zzl&&b.addLegacyAvailableList(zzl);zy={};zx={};if(zzk.newAvailableList){b.presenceData=zzk.newAvailableList;b.haveFullList=true;}if(zzk.interfaces){zl=zzk.interfaces;b.inform(c.ON_INTERFACES_CHANGED,zl);}zzi();zzf();zzj();}function zzg(zzm){if(e.isShutdown()||!i.isOnline()){b._poller.stop();return;}zp=new Date();var zzl=false;if(new Date()-zo>n)zzl=true;zzb=true;var zzk=w.getCachedProfileIDs();zzm.setHandler(zw).setErrorHandler(zv).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:j.user,available_user_info_ids:zzk,fetch_mobile:zzl}).setURI(u).setAllowCrossPageTransition(true);}function zc(zzk,zzm){for(var zzl in zzk){var zzo;var zzn;if(zzm){zzo=c.legacyStatusMap[zzk[zzl].ol];zzn=zzk[zzl].s;}else if(!zzk[zzl]){zzo=c.OFFLINE;}else if(zzk[zzl].i){zzo=c.IDLE;}else if(zzk[zzl].m){zzo=c.MOBILE;}else zzo=c.ACTIVE;zb(zzl,zzo,zzm,zzn);}}function zzi(zzk){var zzl=zg(zzk);y.debug('update_poller',zzl);b._poller&&b._poller.setTimePeriod(zzl);}function za(){b.haveFullList=false;zp=0;zo=0;zza={};zx={};zy={};zs={};zze++;zzf();}function zk(){zzi();if(i.isOnline()){b.update();}else za();}function zi(){zzi();if(e.disconnected()){za();}else if(!b.haveFullList)b.update();}function zj(zzl,zzk){zzk.chat_config=h.getDebugInfo();zzk.available_list_debug_info={};b.getAvailableIDs().forEach(function(zzm){zzk.available_list_debug_info[zzm]=b.getDebugInfo(zzm);});zzk.available_list_poll_interval=b._poller&&b._poller.getTimePeriod();}ze(b,{haveFullList:false,get:function(zzk){if(zzk==j.user)return c.ACTIVE;var zzl=c.OFFLINE;if(zzk in zza)zzl=zza[zzk];if(h&&h.get('blackbird')&&!s.allows(zzk))zzl=c.OFFLINE;if(zzl==c.OFFLINE)if(zs[zzk])zzl=c.MOBILE;return zzl;},getInterfaces:function(){return ze({},zl);},isUserIdle:function(){return zn;},isReady:function(){return b.haveFullList;},set:function(zzk,zzm,zzl){zb(zzk,zzm,true,null,zzl);},update:function(){if(new Date()-zp<o){!zzb&&zzj.defer();return;}b._poller&&b._poller.requestNow();},getRev:function(){return zze;},isIdle:function(zzk){return b.get(zzk)==c.IDLE;},getOnlineIDs:function(){var zzk,zzl=[];for(zzk in zza)if(b.get(zzk)===c.ACTIVE)zzl.push(zzk);return zzl;},getAvailableIDs:function(){var zzl=b.getOnlineIDs();var zzk;for(zzk in zs){if(zzk in zza)continue;zzl.push(zzk);}return zzl;},getOnlineCount:function(zzk){if(zzk&&!b.haveFullList)return 0;return b.getOnlineIDs().length;},addLegacyOverlay:function(zzk){zc(zzk,true);},addLegacyAvailableList:function(zzk){zc(zzk,false);},getDebugInfo:function(zzk){var zzl;if(window.ShortProfiles){var zzm=w.getNow(zzk);if(zzm)zzl=zzm.name;}return {id:zzk,presence:zza[zzk],overlaySource:zx[zzk],overlayTime:zy[zzk],overlaySource:zx[zzk],mobile:zs[zzk],name:zzl};}});b.updateTime=k.updateTime;b.addLegacyAvailableList(k.availableList);b.haveFullList=true;if(k.mobileFriends)zzh(k.mobileFriends);zl=k.interfaces;b._poller=new r(zg(),zzg,true);a.subscribe('chat-visibility/initialized',function(zzk){y.log('visibility_init',zzk);zzi(true);});a.subscribe(l.DUMP_EVENT,zj);x.subscribe(function(zzl,zzk){if(zzk.idleness>zz){y.debug('update_activity');b.update();}});if(h.get('blackbird')){s.subscribe('privacy-changed',zzf);s.subscribe('privacy-availability-changed',function(zzl,zzk){for(var zzm in zzk.user_availabilities)this.set(zzm,zzk.user_availabilities[zzm]);}.bind(b));s.subscribe('privacy-user-presence-response',b.update);}else a.subscribe('chat/visibility-changed',zk);if(h.get('channel_disconnect_warning')){e.subscribe([e.CONNECTED,e.RECONNECTING,e.SHUTDOWN,e.MUTE_WARNING,e.UNMUTE_WARNING],zi);}else e.subscribe(e.CONNECTED,b.update);zh.AvailableList=zt.exports=b;});
var ChatQuietLinks={silence:function(b){if(ua.firefox()>=4||ua.chrome())var a=Event.listen(document,'mousemove',function(){this._removeLinkHrefs(b);a.remove();}.bind(this));},_removeLinkHrefs:function(d){var c=DOM.scry(d,'a');for(var b=0;b<c.length;b++){var a=c[b].getAttribute('href');if(!a||a.charAt(0)=='#')c[b].removeAttribute('href');}}};
__d("GroupChatController",["Arbiter","Chat","ChatConfig","ChatVisibility","dom","css-core","PageTransitions"],function(j,l,m,k,i){var a=l('Arbiter');var c=l('Chat');var d=l('ChatConfig');var e=l('ChatVisibility');var f=l('dom');var b=l('css-core');var h=l('PageTransitions');function g(o,p,q){_goOnlineText=f.find(o,'.fbGroupChatGoOnline');_chatWithGroupText=f.find(o,'.fbGroupChatOpenTab');function n(){if(e.isOnline()){b.hide(_goOnlineText);b.show(_chatWithGroupText);}else{b.hide(_chatWithGroupText);b.show(_goOnlineText);}}_visibilitySubscription=a.subscribe('chat/visibility-changed',n);h.registerHandler(a.unsubscribe.bind(a,_visibilitySubscription));Event.listen(o,'click',function(){if(d.get('mercury_integration')){m(['ChatController'],function(r){r.raiseGroupTab(p);});}else e.goOnline(function(){c.openTab(p,q,'group');});});}k.exports=g;});
var ChatSidebar=window.ChatSidebar||(function(){var c=null;var a=null;var b=null;var d=null;var f;var m=false;var n=false;var p=false;var o=false;var t;var s;var v;var z;var za;var r;var g=null;var x=null;var zb=null;var q=JSLogger.create('blackbird');var e=32;function i(zc){switch(zc){case b.HINT_AUTH:return "Your session has timed out. Please log in.";case b.HINT_CONN:return _tx("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case b.HINT_MAINT:return _tx("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return _tx("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}}function h(zd){var ze;if(zd===null){ze="Unable to connect to chat. Check your Internet connection.";}else if(zd>c.get('warning_countdown_threshold_msec')){var zc=$N('a',{href:'#',className:'fbChatReconnectLink'},"Try again");ze=DOM._tx("Unable to connect to chat. {try-again-link}",{'try-again-link':zc});}else if(zd>1000){ze=_tx("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(zd/1000)});}else ze="Unable to connect to chat. Reconnecting...";return ze;}function j(ze,zc){if(x){clearTimeout(x);x=null;}if(ze===a.SHUTDOWN){g=i(zc);}else if(ze===a.CONNECTED){g=null;}else if(ze===a.RECONNECTING){var zd=zc;g=h(zd);if(zd>1000){if(zd>c.get('warning_countdown_threshold_msec')){if(zb){zb.remove();zb=null;}zb=Event.listen(s,'click',function(event){if(CSS.hasClass(event.getTarget(),'fbChatReconnectLink')){a.reconnect();return false;}});}x=setTimeout(bind(null,j,ze,zd-1000),1000,false);}}k();}function k(){var zg=ChatVisibility.isOnline();var zc=false;if(!zg){var zd='fbChatGoOnlineLink';var zf=c.get('blackbird')?"Go online":"available";var ze=$N('a',{href:'#',className:zd},zf);var zh=c.get('blackbird')?DOM._tx("{=Go online} to see who's online to chat.",{'=Go online':ze}):DOM._tx("You are unavailable to chat. Let friends see you as {=available}?",{'=available':ze});DOM.setContent(s,zh);Event.listen(s,'click',function(event){if(CSS.hasClass(event.getTarget(),zd)){if(ChatVisibility.isOnline()){q.error('sidebar_go_online_while_online');q.rate('sidebar_go_online_error',c.get('blackbird'));}q.rate('sidebar_go_online',c.get('blackbird'));ChatVisibility.goOnline();return false;}});CSS.addClass(v,'offline');}else{CSS.removeClass(v,'offline');DOM.empty(s);if(a.disconnected()){CSS.addClass(v,'error');DOM.setContent(s,g);}else if(d&&d.isJabberConnected()){CSS.addClass(v,'error');DOM.setContent(s,"You are signed in to Jabber. Chat will not notify you on the web.");}else CSS.removeClass(v,'error');}u();}function l(){if(!ChatSidebar.isVisible()&&o)return;p=false;CSS.hide(v);CSS.removeClass(document.documentElement,'sidebarMode');t.hide();z.getCore().reset();q.rate('sidebar_hide',o);Arbiter.inform('sidebar/hide',ChatSidebar);}function u(){OrderedFriendsList.subscribe('initialized',function(){var zd=ChatSidebar.shouldShowSidebar();CSS.conditionClass(document.documentElement,'sidebarCapable',zd);if(ChatSidebar.isEnabled()&&zd){CSS.setStyle(v,'height',za.y+'px');w();var zc=za.y;$A(v.childNodes).forEach(function(ze){if(ze!==f)zc-=Vector2.getElementDimensions(ze).y;});CSS.setStyle(f,'height',zc+'px');this._maxItems=Math.floor((zc-8)/e);t.setNumTopFriends(this._maxItems);z.getData().setMaxResults(this._maxItems);Arbiter.inform('sidebar/resized',ChatSidebar);}else l();o=true;});}function w(){if(ChatSidebar.isVisible())return;p=true;CSS.show(v);CSS.addClass(document.documentElement,'sidebarMode');t.show();q.rate('sidebar_show',o);Arbiter.inform('sidebar/show',ChatSidebar);}function y(){chatOptions.setSetting('sidebar_mode',ChatSidebar.isEnabled());new AsyncRequest('/ajax/chat/settings.php').setHandler(bagofholding).setErrorHandler(bagofholding).setData({sidebar_mode:ChatSidebar.isEnabled()}).setAllowCrossPageTransition(true).send();}return {init:function(zd,zc,ze){ChatSidebar.init=bagofholding;requireLazy(['ChatConfig','ChannelConnection','ChannelConstants','ChatVisibility','PresencePrivacy'],function(zh,zf,zg,zi,zj){c=zh;a=zf;b=zg;ChatVisibility=zi;PresencePrivacy=zj;if(c.get('mercury_integration'))requireLazy(['ChatInterfaces'],function(zk){d=zk;d.subscribe(d.JABBER_CHANGED,function(){o&&k();});o&&k();});v=zd;t=zc;z=ze;f=DOM.find(zd,'div.fbChatSidebarBody');s=DOM.find(zd,'div.fbChatSidebarMessage div.message');zc.setScrollContainer(DOM.find(f,'div.uiScrollableAreaWrap'));zc.subscribe(['render','show','hide'],debounce(function(){var zk=zc.getRoot();var zl=ScrollableArea.getInstance(zk);zl&&zl.adjustGripper();}));ChatQuietLinks.silence(zd);Event.listen(window,'resize',u);Arbiter.subscribe('chat/option-changed',function(zl,zk){if(zk.name=="sidebar_mode"){m=!!chatOptions.getSetting('sidebar_mode');u();}});ze.subscribe(['respond','reset'],function(zk,zl){if(p)if(zl&&zl.value&&zl.value===ze.getCore().getValue()&&ze.getView().isVisible()){t.hide();}else t.show();});ze.getData().subscribe('beforeQuery',u);a.subscribe([a.CONNECTED,a.SHUTDOWN],j);if(c.get('channel_disconnect_warning')){a.subscribe(a.RECONNECTING,j);a.subscribe([a.MUTE_WARNING,a.UNMUTE_WARNING],k);}Arbiter.subscribe('buddylist-nub/initialized',function(zk,zl){Event.listen(zl.getButton(),'click',function(event){ChatSidebar.enable();return !ChatSidebar.shouldShowSidebar();});});Arbiter.subscribe('chat-options/initialized',function(zk,zl){m=!!zl.getSetting('sidebar_mode');Arbiter.subscribe('chat-visibility/initialized',function(zm){q.rate('sidebar_vis_init',c.get('blackbird'));k();Arbiter.subscribe('chat/visibility-changed',k);if(c.get('blackbird'))PresencePrivacy.subscribe('privacy-user-presence-changed',k);Arbiter.inform('sidebar/initialized',ChatSidebar,Arbiter.BEHAVIOR_PERSISTENT);});});});},disable:function(){if(!ChatSidebar.isEnabled())return;m=false;y();l();},enable:function(){if(ChatSidebar.isEnabled())return;m=true;y();u();!function(){if(ChatSidebar.isVisible())z.getCore().getElement().focus();}.defer();},hide:function(){n=true;l();},unhide:function(){n=false;u();},getBody:function(){return f;},getRoot:function(){return v;},getVisibleWidth:function(){return v&&v.offsetWidth||0;},isEnabled:function(){return m;},isViewportCapable:function(){za=Vector2.getViewportDimensions();return za.x>c.get('sidebar.minimum_width');},shouldShowSidebar:function(){return ChatSidebar.isViewportCapable()&&!n&&OrderedFriendsList.getList().length>c.get('sidebar.min_friends')&&!FbDesktopPlugin.shouldSuppressSidebar();},isVisible:function(){return p;},resize:u,toggle:function(){ChatSidebar.isEnabled()?ChatSidebar.disable():ChatSidebar.enable();}};})();
function VideoEvents(){}Function.mixin(VideoEvents,'Arbiter',{ACTIVATING:'videochat/activating',LOGGING_IN:'videochat/logging_in',GETTING_TOKEN:'videochat/getting_token',CONNECTING:'videochat/connecting',SLOW_CONDITIONS:'videochat/slow_conditions',CALL_INCOMING:'videochat/call_incoming',CALL_CONNECTED:'videochat/call_connected',GOT_CALLEE:'videochat/got_callee',CALL_HANDLED:'videochat/call_handled',CALLEE_ANSWERING:'videochat/callee_answering',FATAL_ERROR:'videochat/fatal_error',CALL_IN_PROGRESS:'videochat/call_in_progress',NOT_AVAILABLE:'videochat/not_available',SERVER_ERROR:'videochat/server_error',ACTIVATE_FAILED:'videochat/activate_failed',ACTIVATE_TIMED_OUT:'videochat/activate_failed_time',WRONG_VERSION_ERROR:'videochat/wrong_version',FATAL_PLUGIN_ERROR:'videochat/plugin_fatality',SILENT_PLUGIN_ERROR:'videochat/plugin_silent_fatality',START_CALL_UI:'videochat/start_call_ui',START_CALL:'videochat/start_call',ANSWER_CALL:'videochat/answer_call',IGNORE_CALL:'videochat/ignore_call',CANCEL_CALL:'videochat/cancel_call',INSTALL_STARTED:'videochat/install_started',INSTALL_COMPLETED:'videochat/install_completed',log:function(a){window.console&&console.log&&console.log(a);},warn:function(a){window.console&&console.warn&&console.warn(a);},error:function(a){window.console&&console.error&&console.error(a);}});
var VideoChatPlugin=function(){};Function.mixin(VideoChatPlugin,'Arbiter',{INSTALL_TYPES:{JAVA:0,MANUAL:1},isSupported:function(){var b=ua.windows()&&((ua.ie()>=7&&!ua.ie64())||ua.firefox()>=3.6||ua.chrome()>=5);var a=(ua.osx()>10.4)&&(ua.firefox()>=3.6||ua.chrome()>=5||ua.safari()>=500);return (b||a);},notifyFromApplet:function(b,a){Arbiter.inform(String(b),{args:String(a)});},isInstalled:function(){var a=false;if(VideoChatPlugin.isSupported())if(VideoChatPlugin.usesActiveX()){var c=null;try{c=new ActiveXObject('SkypeLimited.SkypeWebPlugin');a=!!c;}catch(b){}c=null;}else a=VideoChatPlugin._getInstalledVersion();return a;},usesActiveX:function(){return ua.ie()&&ua.windows()&&!ua.opera();},setLogger:function(a){VideoChatPlugin.log=a||bagofholding;},embed:function(a){Bootloader.loadComponents('VideoChatPluginCore',function(){VideoChatPlugin.embed(a);});},remove:bagofholding,_getInstalledVersion:function(){if(!navigator)return null;navigator.plugins.refresh(false);mimeHandler=navigator.mimeTypes['application/skypesdk-plugin'];return mimeHandler&&mimeHandler.enabledPlugin;}});
var VideoChatView={RINGTONE_PATH:'/sound/bling.mp3',WINDOW_NAME_COOKIE_KEY:'vcpwn',TARGET_ID_COOKIE_KEY:'vctid',inIncomingCall:false,inOutgoingCall:false,inManualInstall:false,tokens:[],init:function(){VideoChatView.subscribe(VideoEvents.CALL_INCOMING,VideoChatView._onIncomingCall);VideoChatView.subscribe(VideoEvents.START_CALL_UI,function(a,b){if(!VideoChatView.inOutgoingCall){VideoChatView.inOutgoingCall=true;if(VideoChatPlugin.isInstalled()){VideoChatView.onOutgoingCall(b.idTarget);}else VideoChatView._invokeCore('promptInstall',b.idTarget);}});if(VideoChatPlugin.isSupported())CSS.addClass(document.documentElement,'videoCallEnabled');onbeforeunloadRegister(function(){if((VideoChatView.inIncomingCall||VideoChatView.inOutgoingCall)&&!VideoChatView.inManualInstall)return "Leaving this page will end your call.";});onleaveRegister(function(){if(VideoChatView.inIncomingCall||VideoChatView.inOutgoingCall){VideoEvents.inform(VideoEvents.CANCEL_CALL,{cause:'leave:page'});VideoChatView.inIncomingCall=false;VideoChatView.inOutgoingCall=false;}});VideoChatView._checkPriorState();},subscribe:function(b,a){VideoChatView.tokens.push(VideoEvents.subscribe(b,a));},onProfileButtonClick:function(a){VideoChatView._invokeCore('onProfileButtonClick',a);},unload:function(){while(VideoChatView.tokens.length)VideoEvents.unsubscribe(VideoChatView.tokens.pop());},mightReloadPostInstall:function(){return ua.windows();},_showDialog:function(b,a){new Dialog().setAllowCrossPageTransition(true).setTop(a?85:125).setAsync(new AsyncRequest(b)).show();},_onIncomingCall:function(a,b){VideoChatView.inIncomingCall=true;VideoChatView._showDialog(URI('/ajax/chat/video/incoming_call.php').setQueryData({idTarget:b.idTarget,callId:b.callId}),true);},onOutgoingCall:function(a){VideoChatView.inOutgoingCall=true;VideoChatView._showDialog('/ajax/chat/video/outgoing_call.php?idTarget='+a);},_checkPriorState:function(){if(VideoChatView.mightReloadPostInstall()){var a=getCookie(VideoChatView.WINDOW_NAME_COOKIE_KEY);if(a){clearCookie(VideoChatView.WINDOW_NAME_COOKIE_KEY);var b=getCookie(VideoChatView.TARGET_ID_COOKIE_KEY);if(b){clearCookie(VideoChatView.TARGET_ID_COOKIE_KEY);if(getCookie(VideoChatView.TARGET_ID_COOKIE_KEY))return;if(VideoChatPlugin.isInstalled())VideoChatView.onOutgoingCall(b);}}}},_invokeCore:function(b){var a=Array.prototype.slice.call(arguments,1);Bootloader.loadComponents('VideoChatViewCore',function(){VideoChatView.initCore();VideoChatView[b].apply(VideoChatView,a);});}};
function PresenceIndicator(){}PresenceIndicator.prototype={init:function(b,a,d){this._id=b;this._firstname=a;this._tooltip=d;this._image=DOM.scry(this._tooltip,'i')[0];this._previousAvail=null;this._jslog=JSLogger.create('presence_indicator');Arbiter.subscribe('chat-visibility/initialized',function(e){this._jslog.log('vis_init',e);this._updateVisibility();}.bind(this));this._subscriptions=[Arbiter.subscribe([AvailableListConstants.ON_AVAILABILITY_CHANGED],this._updateAvailability.bind(this)),Arbiter.subscribe(['chat/visibility-changed'],this._updateVisibility.bind(this))];this._updateAvailability.bind(this).defer();var c=Event.listen(this._tooltip,'click',function(){requireLazy(['AvailableList'],function(e){if(this._previousAvail!=AvailableListConstants.OFFLINE)Chat.openTab(this._id);}.bind(this));}.bind(this));onleaveRegister(function(){c.remove();while(this._subscriptions.length)Arbiter.unsubscribe(this._subscriptions.pop());}.bind(this));},_updateAvailability:function(){requireLazy(['AvailableList','ChatConfig'],function(a,b){if(!a.isReady())return;var e;var d;var c=a.get(this._id);if(c===this._previousAvail)return;this._previousAvail=c;switch(c){case AvailableListConstants.OFFLINE:e=b.get('blackbird')?_tx("{name} is offline",{name:this._firstname}):_tx("{name} is unavailable",{name:this._firstname});d='offline';break;case AvailableListConstants.IDLE:e=_tx("{name} is idle",{name:this._firstname});d='idle';break;case AvailableListConstants.ACTIVE:e=b.get('blackbird')?_tx("{name} is online",{name:this._firstname}):_tx("{name} is available",{name:this._firstname});d='online';break;case AvailableListConstants.MOBILE:e=_tx("{name} is available on mobile",{name:this._firstname});d='mobile';break;default:throw new Error('Invalid availability');}TooltipLink.setTooltipText(this._tooltip,e);CSS.setClass(this._image,d);}.bind(this));},_updateVisibility:function(){requireLazy(['ChatVisibility'],function(a){if(a.isOnline()){CSS.show(this._tooltip);}else CSS.hide(this._tooltip);}.bind(this));}};