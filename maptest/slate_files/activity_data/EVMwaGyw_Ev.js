/*1327389852,176820408*/

if (window.CavalryLogger) { CavalryLogger.start_js(["k5w4H"]); }

__d("Toggler",["array-extensions","event-extensions","Arbiter","ArrayUtils","Class","copyProperties","ContextualThing","ContextualDialogX","css","DataStore","Dialog","dom","dom-core","ObjectUtils"],function(v,x,y,w,t){x("array-extensions");x("event-extensions");var c=x("Arbiter");var d=x("ArrayUtils");var f=x("Class");var s=x("copyProperties");var h=x("ContextualThing");var g=x("ContextualDialogX");var e=x("css");var j=x("DataStore");var k=x("Dialog");var i=x("dom");var u=x("dom-core").ge;var l=x("ObjectUtils");var a=d.createFrom;var b=i.$N;var r=[];var p;function q(){q=bagofholding;Event.listen(document.documentElement,'click',function(event){var z=event.getTarget();r.each(function(za){za.active&&!za.sticky&&!h.containsIncludingLayers(za.getActive(),z)&&!za.inTargetFlyout(z)&&za.inActiveDialog()&&za.hide();});},Event.Priority.URGENT);}var m=function(){this.active=null;this.togglers={};this.setSticky(false);r.push(this);this.subscribe(['show','hide'],m.inform.bind(m));return q();};f.mixin(m,'Arbiter',{show:function(zb){var z=n(this,zb);var zc=z.active;if(zb!==zc){zc&&z.hide();z.active=zb;e.addClass(zb,'openToggler');var za=i.scry(zb,'a[rel="toggle"]');if(za.length>0&&za[0].getAttribute('data-target'))e.removeClass(u(za[0].getAttribute('data-target')),'toggleTargetClosed');i.appendContent(zb,z.getToggler('next'));i.prependContent(zb,z.getToggler('prev'));z.inform('show',z);}},hide:function(zc){var za=n(this,zc);var z=za.active;if(z&&(!zc||zc===z)){e.removeClass(z,'openToggler');var zb=i.scry(z,'a[rel="toggle"]');if(zb.length>0&&zb[0].getAttribute('data-target'))e.addClass(u(zb[0].getAttribute('data-target')),'toggleTargetClosed');l.getValues(za.togglers).each(i.remove);za.inform('hide',za);za.active=null;}},toggle:function(za){var z=n(this,za);if(z.active===za){z.hide();}else z.show(za);},getActive:function(){return n(this).active;},inTargetFlyout:function(za){var z=o(this.getActive());return z&&h.containsIncludingLayers(z,za);},inActiveDialog:function(){var z=k.getCurrent();return !z||i.contains(z.getRoot(),this.getActive());},getToggler:function(za){var z=n(this);if(!z.togglers[za])z.togglers[za]=b('button',{className:'hideToggler',onfocus:function(){var zb=i.scry(z.active,'a[rel="toggle"]')[0];zb&&zb.focus();z.hide();}});return this.togglers[za];},setSticky:function(za){var z=n(this);za=za!==false;if(za!==z.sticky){z.sticky=za;if(za){z._pt&&c.unsubscribe(z._pt);}else z._pt=c.subscribe('page_transition',z.hide.bind(z,null));}return z;}});s(m,m.prototype);s(m,{bootstrap:function(z){var za=z.parentNode;m.getInstance(za).toggle(za);},createInstance:function(za){var z=new m().setSticky(true);j.set(za,'toggler',z);return z;},getInstance:function(za){while(za){var z=j.get(za,'toggler');if(z)return z;if(e.hasClass(za,'uiToggleContext'))return m.createInstance(za);za=za.parentNode;}return (p=p||new m());},listen:function(zb,za,z){return m.subscribe(a(zb),function(zd,zc){if(zc.getActive()===za)return z(zd,zc);});},subscribe:(function(z){return function(zb,za){zb=a(zb);if(zb.contains('show'))r.each(function(zc){if(zc.getActive())za.curry('show',zc).defer();});return z(zb,za);};})(m.subscribe.bind(m))});function n(za,z){if(za instanceof m)return za;return m.getInstance(z);}function o(za){var z=i.scry(za,'a[rel="toggle"]');if(z.length>0&&z[0].getAttribute('data-target'))return u(z[0].getAttribute('data-target'));}w.exports=v.Toggler||m;});